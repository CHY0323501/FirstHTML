<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style >
        body {
            background-size:contain;
            background:fixed url('hw3_musicplayer/Sciencefiction.png') center center no-repeat;
            margin:0;
            padding:0;
        }
        .player {
            width: 600px;
            height: 310px;
            position: absolute;
            left: 50%;                              
            top: 50%;
            border-radius: 25px;
            background-color: rgba(0, 0, 0,0.5);
            border: 8PX solid rgba(255, 255, 255,0.8);
            box-shadow: 0 0 40px white;
            transform:translate(-50%,-50%);
            animation-duration: 1s;
            animation-name:changeColor;
            animation-iteration-count: infinite;
            animation-direction:alternate;
            transition-duration:1s;
        }
        @keyframes changeColor {
            0% {box-shadow: 0 0 40px  rgb(246, 245, 185);}
            100% {box-shadow: 0 0 80px  white;}
        }
        /*開選單時，調整css*/
        .player_change {
            transform:translate(-50%,-50%);
            transition-duration:1s;
            height:600px;
        }
        .button_change {
            transform:translateY(-40%);
            transition-duration:1s;
        }
        .music_list_bg {
            background: linear-gradient(209deg, rgba(227,48,29,0.1), rgba(238,141,61,0.1), rgba(236,240,84,0.1), rgba(84,191,240,0.1), rgba(143,84,240,0.1), rgba(242,106,200,0.1), rgba(238,48,105,0.1));
            animation:music_list_bg1 ease infinite 5s;
            background-size:500% 500%;
            transition-duration:1.5s;
        }
        
        /*調整結束*/
        #info_area+div {
            width:500px;
            height:200px;   /*145*/
            position:absolute;
            top:35%;
            left:8.5%;

        }
        .buttonBG{
            width: 50px;
            height: 50px;
            position: absolute;
            background-color: rgba(255, 255, 255,0.7);
            border:1px solid #808080;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 13px rgba(255, 255, 255,0.8);
            top:25%;
            color:rgba(255, 255, 255, 0.60);
            font-size:3rem;
            text-align:center;
        }
        #controlpanel_two>span{
            top:65%;
        }
        .buttonBG:hover {
            box-shadow: 0 0 17px rgb(255, 255, 255);
        }
        .music_list {
            border-radius: 10px;
            width: 500px;
            height: 230px;
            position:absolute;
            left:50%;
            top:50%;
            transform:translate(-50%,45%);
            opacity:0;
            transition-duration:0.5s;
            transition-delay:0.5s;
        }
        @keyframes music_list_bg1 {
            0% {background-position: 0% 17%;}
            50% {background-position: 100% 84%;}
            100% {background-position: 0% 17%;}
        }                            

        .info_area_play {
            animation-duration: 1.5s;
            animation-name:areaplay;
            animation-iteration-count:infinite;
            animation-direction:alternate;
        }
        @keyframes areaplay {
            0% {box-shadow:0px 0px 5px 5px rgba(249, 255, 102, 0.68) ;}
            25% {box-shadow:0px 0px 5px 5px rgba(254, 216, 170, 0.72)}
            50% {box-shadow:0px 0px 5px 5px rgba(255, 126, 126, 0.66);
                 border:double;}
            75% {box-shadow:0px 0px 5px 5px rgba(144, 251, 139, 0.69)}
            100% {box-shadow:0px 0px 5px 5px rgba(255, 255, 255,0.8);border:double;}
        }
        #info_area {
            width: 500px;
            height: 75px;
            background-color: rgb(0, 0, 0);
            position: absolute;
            left: 50%;
            top: 10%;
            border-radius: 10px;
            border:solid 5px white;
            transform:translate(-50%,0);
        }
        #musicMenu {
            width:600px;
            height:30px;
            font-size:10pt;
            font-weight:800;
            background-color:rgb(0, 0, 0);
            color:white;
            border-radius:20px;
            border:none;
            box-shadow:0px 0px 12px 8px rgba(125, 125, 125, 0.4) ;
            font-family:微軟正黑體;
        }
        #musicMenu:hover {
            box-shadow:0px 0px 5px 5px rgba(102, 217, 255, 0.68) ;
        }
        marquee {
            font-family: 微軟正黑體;
            font-size: 14pt;
            font-weight: 800;
            color: white;
            text-align: center;
            word-spacing:4pt;
            letter-spacing:1pt;
        }
        #marquee_now_song{
            width: 487px;
            height: 72px;
            padding-left:5px;
            padding-right:5px;
        }
        .Slider {
            -webkit-appearance: none;  /* Override default CSS styles */
            width: 25%; /* Full-width */
            height: 6px; /* Specified height */
            background: #d3d3d3; /* Grey background */
            outline: none; /* Remove outline */
            opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
            box-shadow:0 0 2px 1px rgba(255, 255, 255,0.7);
            -webkit-transition: .2s; /* 0.2 seconds transition on hover */
            transition: opacity .2s;
            border-radius:10px;
        }

        /* Mouse-over effects */
        .Slider:hover {
          opacity: 1; /* Fully shown on mouse-over */
        }
        /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */ 
        .Slider::-webkit-slider-thumb {
            -webkit-appearance: none; /* Override default look */
            width: 20px; /* Set a specific slider handle width */
            height: 20px; /* Slider handle height */
            border-radius:50%;
            background:rgba(255, 255, 255,0.7); /* Green background */
            cursor: pointer; /* Cursor on hover */
        }
        .Slider::-webkit-slider-thumb:hover {
            background:rgba(102, 217, 255, 0.68);
            transition:.2s;
            border-radius:5px;
        }
        .Slider:-moz-range-thumb {
            width: 20px; /* Set a specific slider handle width */
            height: 20px; /* Slider handle height */
            border-radius:10px;
            background:rgba(128, 128, 128, 0.75); /* Green background */
            cursor: pointer; /* Cursor on hover */
        }
        #VolumeSlider {
            position:absolute;
            left:50%;
            transform:translate(65%,70px);
        }
        .vol_adjust {
            position:absolute;
            top:70%;
            border:none;
            border-radius:5px;
            background-color:rgba(255, 255, 255, 0.72);
            box-shadow: 0 0 13px rgba(255, 255, 255,0.8);
            transition:.5s;
            font-family:Calibri;
            font-size:0.9rem;
            color:rgba(255, 255, 255, 1);
        }
        .duration {
            position:absolute;
            left:40%;
            top:11%;
            color:white;
            font-family:Calibri;
            letter-spacing:1pt;
        }
        .slider_change {
            box-shadow:0px 0px 5px 5px rgba(102, 217, 255, 0.68) ;
        }
    </style>
</head>
<body>
    <div>

        <audio id="audio" controls="controls">
             <source id="nowSong" src="MUSIC/Zedd,%20Katy%20Perry%20-%20365.mp3" type="audio/mp3" />
        </audio>

        <div id="player" class="player">
            <div id="info_area" class="">
                <marquee id="marquee_now_song" scrollamount="2" direction="up">-請點擊播放-</marquee>
            </div>
            <div style="transition-duration:1s">
                <div id="controlpanel_one" style="height:100px;">
                    <span class="material-icons buttonBG" id="Previous" style="left:3%">skip_previous</span>
                    <span class="material-icons buttonBG" id="Rewind" style="left:17%">fast_rewind</span>
                    <span class="material-icons buttonBG" id="Play" style="left:31%">play_arrow</span>
                    <span class="material-icons buttonBG" id="Stop" style="left:45%">stop</span>
                    <span class="material-icons buttonBG" id="Fast-Forward" style="left:59%">fast_forward</span>
                    <span class="material-icons buttonBG" id="Next" style="left:73%">skip_next</span>
                    <span class="material-icons buttonBG" id="list" style="left:87%" title="change_LARGE">list</span>
                   
                </div>
                <div id="duration" class="duration">00:00 / 00:00</div>
                <div id="controlpanel_two">
                    <span class="material-icons buttonBG" id="Volume" style="left:5%">volume_up</span>
                    <span class="material-icons buttonBG" id="Repeat_all" style="left:20%">repeat</span>
                    <span class="material-icons buttonBG" id="Shuffle" style="left:35%">shuffle</span>
                    <span class="material-icons buttonBG" id="repeat_one" title="repeat_one" style="left:50%">repeat_one</span>
                    <input type="range" min="0" max="100" value="70" class="Slider" id="VolumeSlider">
                    <input class="vol_adjust" id="vol_p" style="width:30px;left:67%;font-weight:900" type="button" value=" ＋ " />
                    <input class="vol_adjust" id="vol_m" style="width:30px;left:75%;font-weight:900" type="button" value=" － " />
                    <input class="vol_adjust" id="vol_info" style="width:30px;left:84%;text-align:center;font-weight:700;color:rgba(255, 255, 255, 0.60)" type="text" value="70" max="100" min="0" readonly="readonly" />
                </div>
                <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,110px);transition-duration:1s">
                    <select id="musicMenu">
                        <option value="MUSIC/Zedd,%20Katy%20Perry%20-%20365.mp3">Zedd & KatyPerry-365</option>
                        <option value="MUSIC/Anne-Marie - Then.mp3">Anne-Marie - Then</option>
                        <option value="MUSIC/Alan Walker, Sabrina Carpenter & Farruko - On My Way.mp3">Alan Walker, Sabrina Carpenter & Farruko - On My Way</option>
                        <option value="MUSIC/蔡依林-玫瑰少年.mp3">蔡依林 - 玫瑰少年</option>
                        <option value="MUSIC/Shawn%20Mendes&Camila%20Cabello%20-%20Senorita.mp3">Shawn Mendes & Camila Cabello - Senorita</option>
                        <option value="MUSIC/Beyonce%20-%20Run%20The%20World.mp3">Beyonce - Run The World</option>
                        <option value="MUSIC/Unknown%20Brain%20Feat.%20Bri%20Tolani-Why%20Do%20I.mp3">Unknown Brain Feat. Bri Tolani - Why Do I</option>
                        <option value="MUSIC/Bellie%20Eilish-Bad%20Guy.mp3">Bellie Eilish - Bad Guy</option>
                        <option value="MUSIC/AvengersThemeRemix.mp3">AvengersThemeRemix</option>
                    </select>
                </div>
                <div id="music_list" class="music_list">

                </div>
            </div>
            
        </div>
       
    </div>
    <script>
        //取得document object
        var audio = document.getElementById("audio");
        var controlpanel_one = document.getElementById("controlpanel_one");
        var controlpanel_two = document.getElementById("controlpanel_two");
        var musicMenu = document.getElementById("musicMenu");
        var nowSong = document.getElementById("nowSong");
        var Next = document.getElementById("Next");
        var Previous = document.getElementById("Previous");
        var marquee_now_song = document.getElementById("marquee_now_song");
        var info_area = document.getElementById("info_area");
        var VolumeSlider = document.getElementById("VolumeSlider");
        var duration = document.getElementById("duration");
        var vol_p = document.getElementById("vol_p");
        var vol_m = document.getElementById("vol_m");
        var vol_info = document.getElementById("vol_info");
        var repeat_one = document.getElementById("repeat_one");
        var player = document.getElementById("player");
        var list = document.getElementById("list");
        var music_list = document.getElementById("music_list");

        //瀏覽器偵測
        function browserTest() {
            if (navigator.userAgent.search("Chrome") != -1)
                return "input";
            if (navigator.userAgent.search("Firefox") != -1)
                return "input";
            if (navigator.userAgent.search("Opera") != -1)
                return "input";
            else
                return "change";
            //console.log(navigator.userAgent);        }

        //在點擊按鈕時，上層的節點也會被觸發事件，故由button父節點來判斷哪個按鈕被觸發
        function objEvent(evt) {                                                               
            obj = evt.target;
            //id = evt.target.id;
            switch (obj.id) {
                case "Play":
                    PlayMusic(obj);
                    break;
                case "Pause":
                    PauseMusic(obj);
                    break;
                case "Stop":
                    StopMusic(obj);
                    break;
                case "Fast-Forward":
                    speedAdjust(1);
                    break;
                case "Rewind":
                    speedAdjust(2);
                    break;
                case "Next":
                    changeSong(true,obj);
                    break;
                case "Previous":
                    changeSong(false,obj);
                    break;
            }
        } 
        //在點擊按鈕時，上層的節點也會被觸發事件，故由button父節點來判斷哪個按鈕被觸發，第二排button
        function objEvent2(evt2) {
            obj = evt2.target;
            switch (obj.id) {
                case "Volume":
                    Mute(true,obj);
                    break;
                case "Mute":
                    Mute(false,obj);
                    break;
                case "repeat_one":
                    MusicRepeatOne(obj);
                    break;
                case "Repeat_all":
                    MusicRepeatAll();
                    break;
                case "vol_p":
                    changeVolume(2);
                    break;
                case "vol_m":
                    changeVolume(3);
                    break;
            }

        }
        //將時間從秒數轉換為幾分幾秒的格式        function getTimeFormat(timeSec) {
            minute = Math.floor(timeSec / 60);
            second = timeSec % 60;
            minute = minute < 10 ? "0" + minute : minute;
            second = second < 10 ? "0" + second : second;
            return minute + ":" + second;
        }
        //取得目前播放時間資訊
        function getDuration() { 
            songDuration = Math.round(audio.duration);
            songCurrent = Math.round(audio.currentTime);
            //while (songDuration == NaN) {
                    
            //    duration.innerText = getTimeFormat(songCurrent) + " / 00:00";
            //}
            duration.innerText = getTimeFormat(songCurrent) + " / " + getTimeFormat(songDuration);
            if (songDuration == songCurrent) {
                changeSong(true,Previous.nextElementSibling.nextElementSibling);
            }
            setTimeout(getDuration, 1000);
        }
        //下拉式選單中直接換歌，直接選歌後會直接播放歌曲
        function changeMusicMenu() {
            index = musicMenu.selectedIndex;
            nowSong.src = musicMenu.options[index].value;
            musicMenu.options[index].selected = true;            audio.currentTime = 0;
            if (audio.paused == false) {
                audio.autoplay = "autoplay";
                PlayMusic(Next.previousElementSibling.previousElementSibling.previousElementSibling);
            } 
            ChangeMarquee("play");
        } 
        //播放音樂並改圖示為暫停、播放音樂時啟動資訊看板邊框特效，預設全曲循環
        function PlayMusic(obj) {
            audio.load();
            audio.play();
            obj.id = "Pause";
            obj.innerText = "pause";
            ChangeMarquee("play");
            info_area.className = "info_area_play";
            getDuration();
        }
        //暫停音樂並改圖示為播放
        function PauseMusic(obj) {
            audio.pause();
            obj.id = "Play";
            obj.innerText = "play_arrow";
            info_area.className = "";
            ChangeMarquee("pause");
        }
        //停止音樂，將前一個兄弟(即播放暫停按鈕)改為播放圖示
        function StopMusic(obj) {
            PauseMusic(obj.previousElementSibling);             
            audio.currentTime = 0;
            info_area.className = "";
            ChangeMarquee("stop");
        }
        //快轉、倒轉
        function speedAdjust(flag) {
            if (flag == 1) {
                audio.currentTime += 10;
                ChangeMarquee("fast");
            } else {
                audio.currentTime -= 10;
                ChangeMarquee("rewind");
            }
        }
        //上一首、下一首，若在第一首歌按上一首，則回到最後一首(環狀)
        function changeSong(flag,obj) {
            index = musicMenu.selectedIndex;
            lastMusic_index = musicMenu.options.length - 1;
            if (flag == true) {
                if (index < lastMusic_index) {
                    index++;
                } else {
                    index = 0;
                }
            } else {
                if (index > 0) {
                    index--;
                } else {
                    index = lastMusic_index;
                }
            }
            nowSong.src = musicMenu.options[index].value;
            musicMenu.options[index].selected = true;
            changeMusicMenu();
        } 
        //靜音、取消靜音
        function Mute(a,b) {
            if (a) {
                audio.muted = true;
                b.innerText = "volume_off";
                b.id = "Mute";
            } else {
                audio.muted = false;
                b.innerText = "volume_up";
                b.id = "Volume";
            }
        }
        //改變跑馬燈狀態
        function ChangeMarquee(x) {
            index = musicMenu.selectedIndex;
            if (x == "play") {
                marquee_now_song.innerText = "目前播放：" + musicMenu.options[index].innerText;
            } else if (x == "pause") {
                marquee_now_song.innerText = "-音樂暫停-";
            } else if (x == "stop") {
                marquee_now_song.innerText = "-音樂停止-";
            } else if (x == "fast") {
                marquee_now_song.innerText = "-音樂快轉-";
                setTimeout(function () {marquee_now_song.innerText = "-請點擊播放-"; }, 2000);
                if (controlpanel_one.firstElementChild.nextElementSibling.nextElementSibling.id == "Pause") {
                    checkNowStatement();
                }
            } else if (x == "rewind") {
                marquee_now_song.innerText = "-音樂倒轉-";
                setTimeout(function () {marquee_now_song.innerText = "-請點擊播放-"; }, 2000);
                if (controlpanel_one.firstElementChild.nextElementSibling.nextElementSibling.id == "Pause") {
                    checkNowStatement();
                }
            }
        }
        //判斷目前是否播放顯示對應跑馬燈
        function checkNowStatement() {
            if (controlpanel_one.firstElementChild.nextElementSibling.nextElementSibling.id == "Pause") {
                    setTimeout(function () {
                    ChangeMarquee("play");
                    }, 2000);
                } else {
                    setTimeout(function () {
                    ChangeMarquee("pause");
                    }, 2000);
                }
        }
        //單曲循環
        function MusicRepeatOne(obj) {
            if (obj.title=="repeat_one") {
                audio.loop = "loop";
                obj.title = "not_repeat_one";
                repeat_one.style.boxShadow = "0px 0px 15px 3px rgba(102, 217, 255, 0.68)";
            } else  {
                audio.loop = false;
                obj.title = "repeat_one";
                repeat_one.style.boxShadow = "0 0 13px rgba(255, 255, 255,0.8)";
                if (audio.paused == false) {
                    audio.autoplay = "autoplay";
                    PlayMusic(Next.previousElementSibling.previousElementSibling.previousElementSibling);
                }
            }
        }
        //全曲循環
        function MusicRepeatAll() {
            lastMusic_index = (musicMenu.options.length) - 1;
            nowMusic_index = musicMenu.selectedIndex;
            if (lastMusic_index == nowMusic_index) {
                musicMenu.options[0].selected = true;
                changeMusicMenu();
            } else {
                changeSong(true);
            }
        }
        //音量設定
        function changeVolume(flag) {
            if (flag == 2) {
                VolumeSlider.value++;
            } else if (flag == 3) {
                VolumeSlider.value--;
            }
            vol_info.value = VolumeSlider.value;
            vol_info.className += " slider_change";
            setTimeout(slider_Change_control, 1000);
            audio.volume = vol_info.value / 100;
        }
        function slider_Change_control() {
            vol_info.className= "vol_adjust";
        }
        //清單展開效果
        function changeCSS() {
            if (list.value=="change_LARGE") {
                player.className += " player_change";
                info_area.nextElementSibling.className += "button_change";
                controlpanel_two.nextElementSibling.style.top = "185%";
                list.value = "change_SMALL";
                music_list.style.opacity = "1";
                music_list.style.border = "solid 5px rgba(255, 255, 255,0.8)";
                music_list.className = "music_list music_list_bg ";
            } else {
                list.value = "change_LARGE";
                player.className = "player";
                info_area.nextElementSibling.className = "";
                controlpanel_two.nextElementSibling.style.top = "50%";
                music_list.style.opacity = "0";
                music_list.style.border= "";
                music_list.className = "music_list";
            }
        }

       
        //事件監聽器
        controlpanel_one.addEventListener("click", objEvent);
        controlpanel_two.addEventListener("click", objEvent2);
        musicMenu.addEventListener("change", changeMusicMenu);

        audio.addEventListener("ended", MusicRepeatAll);
        VolumeSlider.addEventListener(browserTest(), function () { changeVolume(1); });
        list.addEventListener("click", function () { changeCSS(); }); 
    </script>
</body>
</html>